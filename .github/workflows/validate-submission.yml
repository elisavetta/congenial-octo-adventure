name: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°ÑÐ²ÐºÐ¸ ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚Ð°

on:
  pull_request:
    paths:
      - 'submissions/**'
    branches: [ main ]
    types: [opened, synchronize, reopened]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÐºÐ¾Ð´
        uses: actions/checkout@v3

      - name: ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð·Ð°ÑÐ²ÐºÐ¸
        run: |
          echo "ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð·Ð°ÑÐ²ÐºÐ¸..."
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ Ð² Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ð¸ PR
          REQUIRED_FIELDS=("ÐŸÐ¾Ð»Ð½Ð¾Ðµ Ð¸Ð¼Ñ:" "Ð’Ð°Ñˆ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð¼:" "ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°:")
          PR_BODY="${{ github.event.pull_request.body }}"
          
          echo "=== ÐÐ°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ Ð² Ð·Ð°ÑÐ²ÐºÐµ ==="
          for field in "${REQUIRED_FIELDS[@]}"; do
            if echo "$PR_BODY" | grep -q "$field"; then
              echo "âœ… $field"
            else
              echo "âŒ ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚: $field"
              echo "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ '$field' Ð² Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ PR"
              exit 1
            fi
          done
          
          echo ""
          echo "âœ… Ð’ÑÐµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ Ð¿Ñ€Ð¸ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚"

      - name: ðŸ·ï¸ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð»ÐµÐ¹Ð±Ð»Ñ‹
        uses: actions/github-script@v6
        with:
          script: |
            const prNumber = context.payload.pull_request.number;
            const title = context.payload.pull_request.title;
            
            // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð»ÐµÐ¹Ð±Ð»Ñ‹ Ð² Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ Ñ‚Ð¸Ð¿Ð° Ð·Ð°ÑÐ²ÐºÐ¸
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
              labels: ['Ð½Ð¾Ð²Ð°Ñ-Ð·Ð°ÑÐ²ÐºÐ°', 'Ð¾Ð¶Ð¸Ð´Ð°ÐµÑ‚-Ñ€ÐµÐ²ÑŒÑŽ']
            });
            
            console.log('Ð›ÐµÐ¹Ð±Ð»Ñ‹ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹');

      - name: ðŸ“Š Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¾Ñ‚Ñ‡ÐµÑ‚ Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐµ
        run: |
          echo "## ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐµ Ð·Ð°ÑÐ²ÐºÐ¸" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹:** ÐŸÐ ÐžÐ™Ð”Ð•ÐÐ" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ:** Ð²ÑÐµ Ð¿Ñ€Ð¸ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ·ï¸ **Ð›ÐµÐ¹Ð±Ð»Ñ‹:** Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹ 'Ð½Ð¾Ð²Ð°Ñ-Ð·Ð°ÑÐ²ÐºÐ°', 'Ð¾Ð¶Ð¸Ð´Ð°ÐµÑ‚-Ñ€ÐµÐ²ÑŒÑŽ'" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Ð§Ñ‚Ð¾ Ð´Ð°Ð»ÑŒÑˆÐµ?**" >> $GITHUB_STEP_SUMMARY
          echo "1. ÐœÐµÐ½Ñ‚Ð¾Ñ€Ñ‹ ÑƒÐ²Ð¸Ð´ÑÑ‚ Ð²Ð°ÑˆÑƒ Ð·Ð°ÑÐ²ÐºÑƒ Ð² ÑÐ¿Ð¸ÑÐºÐµ PR" >> $GITHUB_STEP_SUMMARY
          echo "2. Ð ÐµÐ²ÑŒÑŽ Ð½Ð°Ñ‡Ð½ÐµÑ‚ÑÑ Ð² Ñ‚ÐµÑ‡ÐµÐ½Ð¸Ðµ 48 Ñ‡Ð°ÑÐ¾Ð²" >> $GITHUB_STEP_SUMMARY
          echo "3. Ð¡Ð»ÐµÐ´Ð¸Ñ‚Ðµ Ð·Ð° ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸ÑÐ¼Ð¸ Ð¼ÐµÐ½Ñ‚Ð¾Ñ€Ð¾Ð²" >> $GITHUB_STEP_SUMMARY
